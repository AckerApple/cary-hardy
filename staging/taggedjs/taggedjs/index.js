var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function r(t,e=new WeakMap){if(null===t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));if(e.set(t,n),Array.isArray(t))for(let o=0;o<t.length;o++)n[o]=r(t[o],e);else for(const o in t)t.hasOwnProperty(o)&&(n[o]=r(t[o],e));return n}function n(t,e){if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e||null===t||null===e)return!1;const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const s of r)if(!o.includes(s)||!n(t[s],e[s])){if(t[s]instanceof Function&&e[s]instanceof Function&&t[s].toString()===e[s].toString())continue;return!1}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!n(t[r],e[r]))return!1}else if(Array.isArray(t)||Array.isArray(e))return!1;return!0}function o(t){const e={templater:t,renderCount:0,mutatingRender:()=>{throw new Error('Tag function "render()" was called in sync but can only be called async')},render:()=>(++e.renderCount,e.mutatingRender()),hasPropChanges:(t,r,o)=>{const s=e.templater.cloneProps;return!(void 0===t&&t===o||n(r,s))}};return e}t.d(e,{xQ:()=>p,Vp:()=>B,RN:()=>z,dy:()=>$,ey:()=>H,nc:()=>q,a:()=>l,TF:()=>D,Je:()=>W,SB:()=>J,_q:()=>C,Dc:()=>_});const s=[];function a(t,e){s.forEach((r=>r.beforeRender(t,e)))}function i(t){const e={beforeRender:t.beforeRender||(()=>{}),beforeRedraw:t.beforeRedraw||(()=>{}),afterRender:t.afterRender||(()=>{})};s.push(e)}const u={providers:[],currentTag:void 0,ownerTag:void 0};function c(t){return u.providers.find((e=>e.constructMethod===t))}const l={create:t=>{const e=c(t);if(e)return e.clone=r(e.instance),e.instance;const n=t.constructor?new t:t();return u.providers.push({constructMethod:t,instance:n,clone:r(n)}),n},inject:t=>{const e=c(t);if(e)return e.instance;let n={ownerTag:u.ownerTag};for(;n.ownerTag;){const e=n.ownerTag.providers.find((e=>{if(e.constructMethod===t)return!0}));if(e)return e.clone=r(e.instance),u.providers.push(e),e.instance;n=n.ownerTag}const o=`Could not inject provider: ${t}`;throw console.warn(`${o}. Available providers`,u.providers),new Error(o)}};i({beforeRedraw:(t,e)=>{u.currentTag=e,u.ownerTag=e.ownerTag,e.providers.length&&(u.providers.length=0,u.providers.push(...e.providers))},afterRender:(t,e)=>{e.providers=[...u.providers],u.providers.length=0}});class p{subscribers=[];value;subscribe(t){this.subscribers.push(t),p.globalSubs.push(t),++p.globalSubCount;const e=()=>{d(this.subscribers,t),d(p.globalSubs,t),--p.globalSubCount};return e.unsubscribe=e,e}set(t){this.value=t,this.subscribers.forEach((e=>{e.value=t,e(t)}))}next=this.set}function d(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}p.globalSubCount=0,p.globalSubs=[];class g extends p{value;constructor(t){super(),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value),e}}function f(t,e){function r(r,n){const o=e.tagSupport.renderCount,s=t.bind(r)(...n);if(o===e.tagSupport.renderCount)return e.tagSupport.render(),s instanceof Promise&&s.then((()=>{e.tagSupport.render()})),s}return r.tagFunction=t,r}function h(t,e,r){t.redraw=()=>{const n=e.tag,s=n?.tagSupport||o(t);++s.renderCount,e.tagSupport=s;const i=t;s.mutatingRender=s.mutatingRender||e.tagSupport?.mutatingRender||i.tagSupport.mutatingRender;const c=n?.ownerTag||r;a(s,s.oldest),s.oldest?s.oldest.beforeRedraw():u.ownerTag=c;const l=t.wrapper();l.tagSupport=s,s.oldest?s.oldest.afterRender():l.afterRender(),t.newest=l,l.ownerTag=c;const p=s.oldest=s.oldest||l;s.newest=l;const d=p.tagSupport;if(p.tagSupport=d||s,p.tagSupport.templater=t,l.setSupport(s),!n||!n.isLikeTag(l))return e.set(t),l;p.updateByTag(l)}}function v(t,e,r){const n=t.split(".");if("style"===n[0]&&(r.style[n[1]]=e),"class"===n[0])return n.pop(),void(e?n.forEach((t=>r.classList.remove(t))):n.forEach((t=>r.classList.add(t))))}const w=/^\s*{/,y=/}\s*$/;function b(t,e,r){t.getAttributeNames().forEach((n=>{const o=t.getAttribute(n),s=function(t){return t.search(/^(class|style)(\.)/)>=0}(n);if(o&&o.search(w)>=0&&o.search(y)>=0){const a=o.replace("{","").split("").reverse().join("").replace("}","").split("").reverse().join(""),i=e[a];if(i instanceof Function)return void(t[n]=function(...e){i(t,e)});if(i instanceof p){t.removeAttribute(n);const e=e=>{if(e instanceof Function)return t[n]=function(...r){e(t,r)},void(t[n].tagFunction=e);s&&v(n,e,t),e&&t.setAttribute(n,e),void 0===e||!1===e||null===e?t.removeAttribute(n):t.setAttribute(n,e)},o=i.subscribe(e);return void r.cloneSubs.push(o)}t.setAttribute(n,i.value)}else if(s)return v(n,o,t)}))}const m=/(?:<[^>]*>)|({__tagVar[^}]+})/g;function S(t,e,s){if(!t.children||"TEMPLATE"===t.tagName)return;const i={added:0,removed:0},c=new Array(...t.children);function l(t,c,l){l.forEach(((t,e)=>{if(!(e<c)&&"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end"))return t})),function(t,e,s,i){if(!t.hasAttribute("end"))return;const c=t.getAttribute("id");if(c?.substring(0,L.length)!==L)return;const l=e[c];if(l instanceof p){const e=e=>{!function(t,e,s,i,c){if(t instanceof B)return t.tagSupport||(t.tagSupport=o(),t.tagSupport.mutatingRender=i.tagSupport.mutatingRender,t.tagSupport.oldest=t.tagSupport.oldest||t,i.children.push(t),t.ownerTag=i),void F(t,e,s,{counts:c});if(t instanceof Array&&t.every((t=>t instanceof B)))return function(t,e,r,n,o){t.lastArray=t.lastArray||[];let s=0;return t.lastArray=t.lastArray.filter(((r,n)=>{const a=e.length-1<n-s,i=e[n-s],u=i?.arrayValue;return!a&&u===r.tag.arrayValue||(t.lastArray[n].tag.destroy(o.removed,!1),++s,++o.removed,!1)})),void e.forEach(((e,s)=>{if(e.tagSupport=n.tagSupport,e.ownerTag=n,n.children.push(e),void 0===e.arrayValue&&!Object.keys(e).includes("arrayValue")){const t=new Error("Use html`...`.key(item) instead of html`...` to template an Array");throw t.code="add-array-key",t}const a=t.lastArray[s];if(a)return void(a.tag.arrayValue===e.arrayValue&&a.tag.updateValues(e.values));const i=r||r.clone;F(e,t,i,{index:s,counts:o})}))}(e,t,s,i,c);if(k(t))return function(t,e,s,i,c){if(!0!==t.tagged){let e=t.name||t.constructor?.name;throw"Function"===e&&(e=void 0),new Error(`Not a tag component. Wrap your function with tag(). Example tag(props => html\`\`) on component:\n\n${e||t.toString().substring(0,120)}\n\n`)}const l=e.tagSupport||o(t);l.mutatingRender=()=>{const o=l.renderCount;if(e.tag){if(function(t){t.providers.filter((t=>!n(t.instance,t.clone))).forEach((e=>{!function(t,e){V(t,e).forEach((({tag:t,renderCount:e,provider:n})=>{e===t.tagSupport.renderCount&&(n.clone=r(n.instance),t.tagSupport.render())}))}(t.getAppElement(),e),e.clone=r(e.instance)}))}(e.tag),o!==l.renderCount)return l.newest;if(!l.hasPropChanges(t.props,t.newProps,e.tag.tagSupport.templater.props))return l.newest=t.redraw(t.newProps),l.newest}return l.newest=i.tagSupport.render()};const p=t;let d=p.newest;u.ownerTag=i;const g=!d;return a(l,d),g&&(d=p.wrapper(),d.tagSupport=l,d.afterRender(),p.oldest=d,l.oldest=d,t.oldest=d),p.newest=d,d.ownerTag=i,d.ownerTag=i,i.children.push(d),d.setSupport(l),void F(d,e,s,{counts:c})}(t,e,s,i,c);if(e.tag){const r=s.clone||s;r.parentNode.insertBefore(s,r);const n=c.removed,o=e.tag.destroy(n);c.removed=n+o,delete e.tag;const a=P(t,r);return void(s.clone=a)}const l=s.clone||s,p=P(t,l);s.clone=p;const d=i.clones.indexOf(l);d>=0&&!i.clones.includes(p)&&!l.parentNode&&(i.clones.splice(d,1),i.clones.push(p))}(e,l,t,s,i),setTimeout((()=>{i.added=0,i.removed=0}),0)},c=l.subscribe(e);return void s.cloneSubs.push(c)}const d=P(l,t.clone||t);s.clones.push(d),t.clone=d}(t,e,s,i)}c.forEach(((t,r)=>{if(l(t,r,c),t.children){const r=new Array(...t.children);r.forEach(((t,n)=>{(function(t){return"TEMPLATE"===t.tagName&&void 0!==t.getAttribute("interpolate")&&void 0!==t.getAttribute("end")})(t)&&l(t,n,r),S(t,e,s)}))}}))}function T(t,e,r){(function(t){const e=function(t){const e=[];return{string:t.replace(m,((t,r)=>{if(t.startsWith("<"))return t;const n=r.substring(1,r.length-1);return e.push(n),`<template interpolate end id="${n}"></template>`})),keys:e}}(t.innerHTML);return e.string=e.string.replace(O,L),t.innerHTML=e.string,e})(t).keys.length&&S(t,e,r),b(t,e,r),function t(n){new Array(...n).forEach((n=>{b(n,e,r),n.children&&t(n.children)}))}(t.children)}function A(t,e,r){const n=document.createElement("div");n.id="tag-temp-holder",n.innerHTML="<div></div>"+e.string,T(n,t.update(),t);const o=function(t,e){const r=[],n=t.children[0];let o=n.nextSibling;for(t.removeChild(n);o;){const t=o.nextSibling;E(o,e),r.push(o),o=t}return r}(n,r);return t.clones.push(...o),o}function E(t,e){e.parentNode.insertBefore(t,e)}class R{props;newProps;cloneProps;tagged;wrapper;newest;oldest;redraw}function C(t){return(e,n)=>{const o=e instanceof B,s=function(t,e){if("object"!=typeof t)return t;const r={...t};return Object.entries(r).forEach((([t,e])=>{r[t]=e instanceof Function?(...t)=>((t,e)=>{const r=t(...e);return i.newest?.ownerTag?.tagSupport.render(),r})(e,t):e})),r}(o?0:e);let a=s;o&&(n=e,a=x);const i=new R;return i.tagged=!0,i.props=e,i.newProps=s,i.cloneProps=r(s),i.wrapper=()=>t(a,n),i}}const x=new class{};function P(t,e){const r=e.parentNode;void 0!==t&&!1!==t&&null!==t||(t="");const n=document.createTextNode(t);return r.insertBefore(n,e),r.removeChild(e),n}function F(t,e,r,{index:n,counts:o}){const s=t.getTemplate();if(void 0!==n){const a=e.lastArray[n];return a?.tag.isLikeTag(t)?void a.tag.updateByTag(t):(A(t,s,r).forEach((t=>j(t,o))),void e.lastArray.push({tag:t,index:n}))}if(e.tag&&e.tag.isLikeTag(t)){if(e instanceof Function){const t=e(e.tag.tagSupport);return void e.tag.updateByTag(t)}e.tag.updateByTag(t)}else A(t,s,r.clone||r).forEach((t=>j(t,o))),e.tag=t}function k(t){return t instanceof R}function j(t,e){t.getAttribute&&(function(t,e){const r=t.oninit;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;o&&(o({target:t,stagger:e.added}),++e.added)}(t,e),t.children&&new Array(...t.children).forEach((t=>j(t,e))))}function V(t,e,r=[]){const n=t.providers.find((t=>t.constructMethod===e.constructMethod));return n&&r.push({tag:t,renderCount:t.tagSupport.renderCount,provider:n}),t.children.forEach((t=>V(t,e,r))),r}const L="__tagVar",M="--"+L+"--",N=new RegExp(L,"g"),O=new RegExp(M,"g");class B{strings;values;context={};clones=[];cloneSubs=[];children=[];tagSupport;ownerTag;arrayValue;constructor(t,e){this.strings=t,this.values=e}providers=[];beforeRedraw(){!function(t,e){s.forEach((r=>r.beforeRedraw(t,e)))}(this.tagSupport,this)}afterRender(){!function(t,e){s.forEach((r=>r.afterRender(t,e)))}(this.tagSupport,this)}key(t){return this.arrayValue=t,this}destroy(t=0,e=!1){return this.children.forEach(((t,e)=>t.destroy(0,!0))),this.destroySubscriptions(),e||(t=this.destroyClones(t)),t}destroySubscriptions(){this.cloneSubs.forEach((t=>t.unsubscribe())),this.cloneSubs.length=0}destroyClones(t=0){return this.clones.reverse().forEach(((e,r)=>{let n=Promise.resolve();e.ondestroy&&(n=function(t,e){const r=t.ondestroy;if(!r)return;const n=r.tagFunction;if(!n)return;const o=n.tagFunction;return o?o({target:t,stagger:e}):void 0}(e,t)),n.then((()=>e.parentNode.removeChild(e)))})),this.clones.length=0,t}updateByTag(t){this.updateConfig(t.strings,t.values),this.tagSupport.templater=t.tagSupport.templater}lastTemplateString=void 0;setSupport(t){this.tagSupport=this.tagSupport||t,this.tagSupport.mutatingRender=this.tagSupport.mutatingRender||t.mutatingRender,this.children.forEach((e=>e.setSupport(t)))}updateConfig(t,e){this.strings=t,this.updateValues(e)}getTemplate(){return{string:this.lastTemplateString=this.strings.map(((t,e)=>t.replace(N,M)+(this.values.length>e?`{${L}${e}}`:""))).join(""),strings:this.strings,values:this.values,context:this.context}}isLikeTag(t){return t.lastTemplateString===this.lastTemplateString&&(t.values.length===this.values.length&&!!t.values.every(((t,e)=>{const r=this.values[e];return t instanceof Function&&r instanceof Function?!(t.toString()!==r.toString()):!(t instanceof B&&r instanceof B&&(t.ownerTag=this,this.children.push(t),t.lastTemplateString||t.getTemplate().string,!t.isLikeTag(r)))})))}update(){return this.updateContext(this.context)}updateValues(t){return this.values=t,this.updateContext(this.context)}updateContext(t){return this.strings.map(((e,r)=>{const s=L+r,i=this.values.length>r,u=this.values[r],c=t[s];if(c){const t=c.value?.tag;if(k(u)){const t=u.cloneProps,e=c.tag;if(!c.tag)return h(u,c,this),void u.redraw(t);const r=e.tagSupport,s=u.tagSupport||r||o(u),a=s.templater?.cloneProps,i=s.templater?.props;if(e&&(void 0===i&&i===t||n(a,t)))return;return h(u,c,this),r.templater=u,void(c.value.tag=r.newest=u.redraw(t))}if(t){const e=t.tagSupport,r=u;a(e,t),e.oldest.beforeRedraw();const n=r.wrapper();return n.tagSupport=e,r.newest=n,e.oldest.afterRender(),t.updateByTag(n),void c.set(u)}return u instanceof Function?void c.set(f(u,this)):void c.set(u)}k(u)?h(u,t[s]=new g(u),this):u instanceof Function?t[s]=function(t,e){return new g(f(t,e))}(u,this):i&&(u instanceof B&&(u.ownerTag=this,this.children.push(u)),t[s]=new g(u))})),t}getAppElement(){let t=this;for(;t.ownerTag;)t=t.ownerTag;return t}}function $(t,...e){return new B(t,e)}function _(t){return new Promise((e=>{setTimeout((()=>{e(0)}),t)}))}function D(t,e,r){const n=t(r),s=function(t){const e=o(t);a(e);const r=e.templater.wrapper();return r.tagSupport=e,r.afterRender(),{tag:r,tagSupport:e}}(n),{tag:i,tagSupport:u}=s;let c;u.mutatingRender=()=>{a(u,i),i.beforeRedraw();const t=c=n.wrapper();return t.setSupport(i.tagSupport),i.afterRender(),i.updateByTag(t),c&&c.destroy(0),c};const l=i.updateValues(i.values),p=i.getTemplate();e.innerHTML=p.string,T(e,l,i)}let H;function W(t){H=t}function q(t){H||t()}i({beforeRender:(t,e)=>{W(e)}});const I={array:[],rearray:[]};function J(t,e){const r=I.rearray[I.array.length];if(r){const t=Q(r);return I.array.push(e),t}return I.array.push(e),t}function Q(t){const[e]=t(U),[r]=t(e);if(r!==U)throw new Error('State property not used correctly.\n\nFor "let" state use `let name = state(default, x => [name, name = x])`\n\nFor "const" state use `const name = state(default)`\n\nProblem function:\n'+t+"\n");return e}i({beforeRender:t=>{t.state=t.state||{newest:[]}},beforeRedraw:t=>{const e=t.state;I.rearray.length=0,e?.newest.length&&I.rearray.push(...e.newest)},afterRender:t=>{if(I.rearray.length&&I.rearray.length!==I.array.length)throw new Error(`States lengths mismatched ${I.rearray.length} !== ${I.array.length}`);I.rearray.length=0;const e=t.state;e.newest.length=0,e.newest.push(...I.array),e.oldest=e.oldest||[...I.array],I.array.length=0}});class U{}let z=()=>t=>()=>{throw new Error("The real callback function was called and that should never occur")};function G(t,e){t.forEach(((t,r)=>{const n=Q(t),[o]=e[r](n)}))}i({beforeRender:t=>{t.callbacks=[],z=()=>{const e=r=>{const n=()=>{const n=t.state,o=e.state,s=n.newest;G(s,o);const a=r();G(o,s),t.render(),a instanceof Promise&&a.finally((()=>{G(o,s),t.render()}))},o=t.state;return n.state=o,n};return t.callbacks.push(e),e}},afterRender:t=>{t.callbacks.forEach((e=>{const r=t.state;e.state=[...r.newest]}))}});var K=e.xQ,X=e.Vp,Y=e.RN,Z=e.dy,tt=e.ey,et=e.nc,rt=e.a,nt=e.TF,ot=e.Je,st=e.SB,at=e._q,it=e.Dc;export{K as Subject,X as Tag,Y as getCallback,Z as html,tt as initCurrentTag,et as onInit,rt as providers,nt as renderAppToElement,ot as setCurrentInitTag,st as state,at as tag,it as wait};